<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>JARVIS Mobile - Satria</title>
    
    <!-- MediaPipe Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>
    
    <style>
        body {
            margin: 0;
            background-color: #000;
            overflow: hidden; /* Mencegah scroll */
            font-family: 'Segoe UI', sans-serif;
            color: #0ff;
            touch-action: none; /* Penting buat HP biar gak refresh saat tarik */
        }

        /* Video disembunyikan, kita pakai Canvas */
        .input_video { display: none; }

        .output_canvas {
            position: absolute;
            left: 0; top: 0;
            width: 100%; height: 100%;
            object-fit: cover;
            transform: scaleX(-1); /* Efek Cermin */
            z-index: 1;
        }

        #hologram-layer {
            position: absolute;
            left: 0; top: 0;
            width: 100%; height: 100%;
            z-index: 10;
            pointer-events: none;
        }

        .holo-card {
            position: absolute;
            background: rgba(0, 20, 40, 0.7);
            border: 1px solid #00f3ff;
            padding: 15px;
            width: 160px; /* Lebih kecil biar muat di HP */
            border-radius: 12px;
            box-shadow: 0 0 10px rgba(0, 243, 255, 0.3);
            backdrop-filter: blur(5px);
            text-align: center;
            transition: box-shadow 0.1s, background 0.1s;
        }
        
        .holo-card h2 { margin: 0; font-size: 2.2em; color: #fff; text-shadow: 0 0 10px #0ff; }
        .holo-card h3 { margin: 0; font-size: 0.9em; color: #00f3ff; text-transform: uppercase; letter-spacing: 1px; }
        .holo-card p { color: #aaa; font-size: 0.7em; margin-top: 5px;}

        .grabbed {
            background: rgba(0, 243, 255, 0.3);
            box-shadow: 0 0 25px rgba(0, 243, 255, 0.9);
            border-color: #fff;
            z-index: 100;
        }

        #loading {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 999;
            display: flex; justify-content: center; align-items: center; flex-direction: column;
            color: #0ff; text-align: center; padding: 20px;
        }
        .loader {
            border: 4px solid #111; border-top: 4px solid #0ff; border-radius: 50%;
            width: 50px; height: 50px; animation: spin 1s linear infinite; margin-bottom: 20px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        #cursor-viz {
            position: absolute;
            width: 30px; height: 30px; /* Lebih besar biar kelihatan di HP */
            border: 3px solid #0ff;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none;
            z-index: 99;
            display: none;
            box-shadow: 0 0 15px #0ff;
            transition: border-color 0.1s;
        }
    </style>
</head>
<body>

    <div id="loading">
        <div class="loader"></div>
        <div style="font-weight:bold; letter-spacing: 2px;">SYSTEM BOOTING</div>
        <div style="font-size: 14px; color: #888; margin-top: 15px;">
            1. Izinkan Kamera<br>
            2. Mundurkan HP sedikit<br>
            3. Cubit (Jempol + Telunjuk) untuk geser
        </div>
    </div>

    <!-- playsinline penting buat iOS/Android chrome biar gak fullscreen player -->
    <video class="input_video" playsinline></video>
    <canvas class="output_canvas"></canvas>

    <div id="cursor-viz"></div>

    <div id="hologram-layer">
        <!-- Posisi disesuaikan mode portrait -->
        <div class="holo-card" id="card-ipk" style="top: 15%; left: 50%; transform: translateX(-50%);">
            <h3>Indeks Prestasi</h3>
            <h2>3.34</h2>
            <p>GPA / KUMULATIF</p>
        </div>

        <div class="holo-card" id="card-sks" style="top: 40%; left: 50%; transform: translateX(-50%);">
            <h3>Total SKS</h3>
            <h2>61</h2>
            <p>CREDITS COMPLETED</p>
        </div>

        <div class="holo-card" id="card-profile" style="top: 65%; left: 50%; transform: translateX(-50%);">
            <h3>ID: 24053010036</h3>
            <div style="font-size: 1.2em; font-weight: bold; color:white; margin: 5px 0;">SATRIA RAFIE</div>
            <p>D. INTERIOR</p>
        </div>
    </div>

<script>
    const videoElement = document.getElementsByClassName('input_video')[0];
    const canvasElement = document.getElementsByClassName('output_canvas')[0];
    const canvasCtx = canvasElement.getContext('2d');
    const loadingScreen = document.getElementById('loading');
    const cursorViz = document.getElementById('cursor-viz');
    
    let isGrabbing = false;
    let grabbedElement = null;
    let grabOffsetX = 0;
    let grabOffsetY = 0;

    // Tambahkan style transform manual biar posisi awal rapi
    // Kita hapus transform CSS saat digrab biar koordinatnya akurat
    const interactables = [
        document.getElementById('card-ipk'),
        document.getElementById('card-sks'),
        document.getElementById('card-profile')
    ];

    function onResults(results) {
        if(results.multiHandLandmarks && loadingScreen.style.display !== 'none') {
            loadingScreen.style.display = 'none';
        }

        canvasElement.width = window.innerWidth;
        canvasElement.height = window.innerHeight;

        canvasCtx.save();
        canvasCtx.clearRect(0, 0, canvasElement.width, canvasElement.height);
        canvasCtx.translate(canvasElement.width, 0);
        canvasCtx.scale(-1, 1);

        if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
            for (const landmarks of results.multiHandLandmarks) {
                // Gambar Skeleton Tangan
                drawConnectors(canvasCtx, landmarks, HAND_CONNECTIONS, {color: 'rgba(0, 243, 255, 0.5)', lineWidth: 1});
                drawLandmarks(canvasCtx, landmarks, {color: '#ffffff', lineWidth: 0.5, radius: 2});

                // Index (8) & Thumb (4)
                const indexTip = landmarks[8];
                const thumbTip = landmarks[4];

                // Konversi koordinat
                const x1 = (1 - indexTip.x) * window.innerWidth; 
                const y1 = indexTip.y * window.innerHeight;
                const x2 = (1 - thumbTip.x) * window.innerWidth;
                const y2 = thumbTip.y * window.innerHeight;

                // Jarak & Tengah
                const distance = Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));
                const centerX = (x1 + x2) / 2;
                const centerY = (y1 + y2) / 2;

                // Update Cursor
                cursorViz.style.display = 'block';
                cursorViz.style.left = centerX + 'px';
                cursorViz.style.top = centerY + 'px';

                // Threshold Cubit (Lebih longgar buat HP karena jari di layar kecil terlihat dekat)
                const PINCH_THRESHOLD = 80; 

                if (distance < PINCH_THRESHOLD) {
                    // --- MENCUBIT ---
                    cursorViz.style.borderColor = '#ff003c';
                    cursorViz.style.backgroundColor = 'rgba(255, 0, 60, 0.5)';

                    if (!isGrabbing) {
                        interactables.forEach(el => {
                            const rect = el.getBoundingClientRect();
                            if (centerX >= rect.left && centerX <= rect.right && 
                                centerY >= rect.top && centerY <= rect.bottom) {
                                
                                isGrabbing = true;
                                grabbedElement = el;
                                grabbedElement.classList.add('grabbed');
                                
                                // Reset transform CSS biar gak konflik sama absolute positioning
                                grabbedElement.style.transform = 'none'; 
                                
                                grabOffsetX = centerX - rect.left;
                                grabOffsetY = centerY - rect.top;
                            }
                        });
                    } else {
                        // Geser Elemen
                        if (grabbedElement) {
                            grabbedElement.style.left = (centerX - grabOffsetX) + 'px';
                            grabbedElement.style.top = (centerY - grabOffsetY) + 'px';
                        }
                    }

                } else {
                    // --- LEPAS ---
                    cursorViz.style.borderColor = '#00f3ff';
                    cursorViz.style.backgroundColor = 'transparent';
                    
                    if (isGrabbing) {
                        isGrabbing = false;
                        if (grabbedElement) {
                            grabbedElement.classList.remove('grabbed');
                            grabbedElement = null;
                        }
                    }
                }
                break; // Ambil 1 tangan saja
            }
        } else {
            cursorViz.style.display = 'none';
        }
        canvasCtx.restore();
    }

    const hands = new Hands({locateFile: (file) => {
        return `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`;
    }});

    // Optimasi performa HP
    hands.setOptions({
        maxNumHands: 1,
        modelComplexity: 0, // 0 = Lite (Cepat), 1 = Full (Akurat)
        minDetectionConfidence: 0.5,
        minTrackingConfidence: 0.5
    });

    hands.onResults(onResults);

    const camera = new Camera(videoElement, {
        onFrame: async () => {
            await hands.send({image: videoElement});
        },
        width: 1280,
        height: 720,
        facingMode: 'user' // Pastikan pakai kamera depan
    });

    camera.start();
</script>

</body>
</html>
